for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
n.sub <- ncol(ex.haps)/2
n.snp <- nrow(ex.haps)
range(cor(genotype_new[,1:20])[upper.tri(cor(genotype_new[,1:20]))])
cor(genotype_new[,1:20])
hist((cor(genotype_new[,1:20])[upper.tri(cor(genotype_new[,1:20]))]))
library(ggplot2)
theme_Publication <- function(base_size=12) {
library(grid)
library(ggthemes)
(theme_foundation(base_size=base_size, )
+ theme(plot.title = element_text(face = "bold",
size = rel(1.1), hjust = 0.5),
text = element_text(),
panel.background = element_rect(colour = NA),
plot.background = element_rect(colour = NA),
panel.border = element_rect(colour = NA),
axis.title = element_text(face = "bold",size = rel(1)),
axis.title.y = element_text(angle=90,vjust =2),
axis.title.x = element_text(vjust = -0.2),
axis.text = element_text(),
axis.line = element_line(colour="black"),
axis.ticks = element_line(),
panel.grid.major = element_line(colour="#f0f0f0"),
panel.grid.minor = element_line(colour="#f0f0f0"),
legend.key = element_rect(colour = NA),
#legend.position = "bottom",
#legend.direction = "horizontal",
#legend.key.size= unit(0.2, "cm"),
#legend.margin = unit(0, "cm"),
legend.title = element_text(face="bold.italic"),
plot.margin=unit(c(10,5,5,5),"mm"),
strip.background=element_rect(colour="#f0f0f0",fill="#f0f0f0"),
strip.text = element_text(face="bold")
))
}
scale_fill_Publication <- function(...){
library(scales)
discrete_scale("fill","Publication",manual_pal(values = c("#386cb0","#EF7E3D","#FFD042","#7fc97f","#004953","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
scale_colour_Publication <- function(...){
library(scales)
discrete_scale("colour","Publication",manual_pal(values = c("#386cb0","#EF7E3D","chartreuse4","#7fc97f","#004953","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)
}
data <- (cor(genotype_new[,1:20])[upper.tri(cor(genotype_new[,1:20]))])
data
data <- data.frame((cor(genotype_new[,1:20])[upper.tri(cor(genotype_new[,1:20]))]))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()
ggplot(data,aes(correlation))+geom_histogram()+theme_Publication()
library(ggthems)
install.packages("ggthemes")
ggplot(data,aes(correlation))+geom_histogram()+theme_Publication()
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
ex.haps <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.haps"))
ex.hap1 <- ex.haps[,1:60]
ex.gen <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.out1.controls.gen"))
n.sub <- (ncol(ex.gen)-5)/3
n.snp <- nrow(ex.gen)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.gen[,3*k+4]+2*ex.gen[,3*k+5]
}
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
genotype_new1 = genotype_new
dim(genotype_new1)
ex.gen <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.out2.controls.gen"))
n.sub <- (ncol(ex.gen)-5)/3
n.snp <- nrow(ex.gen)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.gen[,3*k+4]+2*ex.gen[,3*k+5]
}
range(data)
ex.haps <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.haps"))
ex.hap1 <- ex.haps[,1:60]
MAF <- rowSums(ex.hap1)/(2*ncol(ex.hap1))
ex.hap2 <- ex.haps[,61:120]
write.table(ex.hap1,file = paste0("./Hapgen2_test/hapgen2/example/ex.hap1"),row.names = F,col.names = F,quote = F)
ex.gen <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.out1.controls.gen"))
n.sub <- (ncol(ex.gen)-5)/3
n.snp <- nrow(ex.gen)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.gen[,3*k+4]+2*ex.gen[,3*k+5]
}
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
genotype_new1 = genotype_new
ex.gen <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.out2.controls.gen"))
n.sub <- (ncol(ex.gen)-5)/3
n.snp <- nrow(ex.gen)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.gen[,3*k+4]+2*ex.gen[,3*k+5]
}
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
genotype_new2 = genotype_new
dim(genotype_new1)
dim(genotype_new2)
ex.gen <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.out1.controls.gen"))
n.sub <- (ncol(ex.gen)-5)/3
n.snp <- nrow(ex.gen)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.gen[,3*k+4]+2*ex.gen[,3*k+5]
}
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
genotype_new1 = genotype_new
ex.gen <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.out2.controls.gen"))
n.sub <- (ncol(ex.gen)-5)/3
n.snp <- nrow(ex.gen)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.gen[,3*k+4]+2*ex.gen[,3*k+5]
}
# MAF <- rowSums(genotype)/(2*n.sub)
# idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
genotype_new2 = genotype_new
dim(genotype_new1)
dim(genotype_new2)
#range(cor(genotype_new1)[upper.tri(cor(genotype_new1))])
range((cor(genotype_new1,genotype_new2)))
#range(cor(genotype_new1)[upper.tri(cor(genotype_new1))])
dim(cor(genotype_new1,genotype_new2))
range((cor(genotype_new1,genotype_new2)))
data <- data.frame((cor(genotype_new1,genotype_new2)))
colnames(data) <- "correlation"
library(ggthems)
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
data <- data.frame((cor(genotype_new1,genotype_new2)))
colnames(data) <- "correlation"
library(ggthems)
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
data
data <- data.frame(as.vector(cor(genotype_new1,genotype_new2)))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
data
cor(genotype_new1,genotype_new2)
library(data.table)
setwd("/Users/haoyuzhang/GoogleDrive/multi_ethnic")
ex.haps <- as.data.frame(fread("./Hapgen2_test/hapgen2/example/ex.haps"))
n.sub <- ncol(ex.haps)/2
n.snp <- nrow(ex.haps)
n.snp
n.sub
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){}
ex.haps[1:10,1:10]
for(k in 1:n.sub){
genotype[,k] <- ex.haps[,2*k-1]+ex.haps[,2*k]
}
genotype[1:10,1:10]
MAF <- rowSums(genotype)/(2*.sub)
MAF <- rowSums(genotype)/(2*n.sub)
MAF
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
length(idx)
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
cor(genotype_new[,1:10])
library(ggplot2)
data <- data.frame((cor(genotype_new)[upper.tri(cor(genotype_new))]))
colnames(data) <- "correlation"
library(ggthems)
head(data)
data <- data.frame((cor(genotype_new)[upper.tri(cor(genotype_new))]))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
range(data)
ex.hap <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
dim(ex.hap)
dim(ex.hap)
n.sub <- ncol(ex.haps)/2
n.snp <- nrow(ex.haps)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.haps[,2*k-1]+ex.haps[,2*k]
}
MAF <- rowSums(genotype)/(2*n.sub)
MAF
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
length(idx)
ex.hap2 <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
rm(ex.hap2)
gc()
ex.haps <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
dim(ex.hap)
n.sub <- ncol(ex.haps)/2
n.snp <- nrow(ex.haps)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.haps[,2*k-1]+ex.haps[,2*k]
}
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
length(idx)
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
cor(genotype_new[,1],genotype_new[,2])
data <- data.frame((cor(genotype_new)[upper.tri(cor(genotype_new))]))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
range(data)
head(data)
length(data)
dim(data)
dim(genotype_common)
data <- data.frame((cor(genotype_new[,1:100])[upper.tri(cor(genotype_new[,1:100]))]))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
range(data)
head(cor(genotype_new[,1:100])
)
data <- data.frame((cor(genotype_new[,1:200])[upper.tri(cor(genotype_new[,1:200]))]))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
ex.haps <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
dim(ex.hap)
n.sub <- ncol(ex.haps)/2
n.snp <- nrow(ex.haps)
dim(ex.haps)
n.sub <- ncol(ex.haps)/2
n.snp <- nrow(ex.haps)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.haps[,2*k-1]+ex.haps[,2*k]
}
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
length(idx)
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
data <- data.frame((cor(genotype_new[,1:200])[upper.tri(cor(genotype_new[,1:200]))]))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
range(dat)
range(data)
sample <- as.data.frame(fread("./Hapgen2_test/1kg/1000GP_Phase3.sample",header=T))
sample
idx <- which(sample$ID=="HG00146")
idx
sample[idx,]
idx <- which(sample$ID=="HG00147")
idx
max((cor(genotype_new[,1:200]))
)
which.max((cor(genotype_new[,1:200])[upper.tri(cor(genotype_new[,1:200]))])))
data <- data.frame((cor(genotype_new[,1:200])[upper.tri(cor(genotype_new[,1:200]))]))
which.max(data)
which.max(data)
colnames(data) <- "correlation"
which.max(data)
range(data)
idx <- which(data==0.5416111)
idx
dim(sample)
cor(genotype_new[,1:10])
head(sample)
dim(genotype_new)
dim(sample)
head(sample)
sample[9,]
idx <- which(sample$ID=="HG00158")
idx
idx <- which(sample$ID=="HG00153")
idx
idx <- which(sample$ID=="HG00403")
idx
idx <- which(sample$ID=="HG00404")
idx
idx <- which(sample$ID=="HG00405")
idx
cor(genotype_new[,1:20])
cor(genotype_new[,1:30])
cor(genotype_new[,1:40])
which.max(cor(genotype_new[,1:100]))
which.max(cor(genotype_new[,1:100])[upper.tri(cor(genotype_new[,1:100]))])
cor(genotype_new[,1:100])[upper.tri(cor(genotype_new[,1:100]))][250]
which(cor(genotype_new[,1:100])==0.5416111,arr.ind = T)
a = cor(genotype_new[,1:100])
a
which(a==0.5416111,arr.ind = T)
which(a==0.111178992,arr.ind = T)
which.max(a,arr.ind = T)
which(0.111178991<a<0.111178993,arr.ind = T)
which(0.111178991<a&a<0.111178993,arr.ind = T)
which(0.5416110<a&a<0.5416112,arr.ind = T)
sample[19,]
sample[23,]
ex.haps <- as.data.frame(fread(gzfile("/dcl01/chatterj/data/hzhang1/1000GP_Phase3/1000GP_Phase3_chr22.hap.gz")))
ex.haps <- as.data.frame(read.table(gzfile("/dcl01/chatterj/data/hzhang1/1000GP_Phase3/1000GP_Phase3_chr22.hap.gz")))
ex.haps <- as.data.frame(read.table("./Hapgen2_test/1kg/test.hap",header=F))
ex.haps <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
dim(ex.haps)
ex.haps <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
dim(ex.haps)
ex.haps <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
ex.haps <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
dim(ex.haps)
n.sub <- ncol(ex.haps)/2
n.snp <- nrow(ex.haps)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.haps[,2*k-1]+ex.haps[,2*k]
}
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
length(idx)
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
data <- data.frame((cor(genotype_new[,1:10])[upper.tri(cor(genotype_new[,1:10]))]))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
head(data)
tail(data)
data <- data.frame((cor(genotype_new)[upper.tri(cor(genotype_new))]))
data <- data.frame((cor(genotype_new[,100])[upper.tri(cor(genotype_new[,100]))]))
colnames(data) <- "correlation"
data <- data.frame((cor(genotype_new[,100])[upper.tri(cor(genotype_new[,100]))]))
cor(genotype_new[,100])
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
cor(genotype_new[,100])
dim(genotype_new)
genotype_new[1:10,1:10]
class(genotype_new)
data <- data.frame((cor(genotype_new[,1:100])[upper.tri(cor(genotype_new[,1:100]))]))
colnames(data) <- "correlation"
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
dim(ex.haps)
range(cor(genotype_new[,1:100])[upper.tri(cor(genotype_new[,1:100]))])
dim(genotype_common)
sample <- as.data.frame(fread("./Hapgen2_test/1kg/1000GP_Phase3.sample",header=T))
head(sample)
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
length(idx)
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
jdx <- which(sample$GROUP=="EUR")
length(jdx)
data <- data.frame((cor(genotype_new[,jdx[1:100]])[upper.tri(cor(genotype_new[,jdx[1:100]]))]))
colnames(data) <- "correlation"
range(data)
ggplot(data,aes(correlation))+geom_histogram()+
theme_Publication()+
xlab("genotypic correlation")
dim()genotype_new
dim(genotype_new)
jdx <- which(sample$GROUP=="EUR")
genotype_new_tar <- genotype_new[,jdx]
data <- data.frame((cor(genotype_new_tar[,1:100])[upper.tri(cor(genotype_new_tar[,1:100]))]))
colnames(data) <- "correlation"
range(data)
head(data)
head(sample)
jdx <- which(sample$GROUP=="GBR")
genotype_new_tar <- genotype_new[,jdx]
dim(genotype_new_tar)
jdx <- which(sample$POP=="GBR")
length(jdx)
genotype_new_tar <- genotype_new[,jdx]
data <- data.frame((cor(genotype_new_tar)[upper.tri(cor(genotype_new_tar))]))
range(data)
idx <- which(data==0.5416111)
idx <- which(cor(genotype_new_tar)<=0.53&
cor(genotype_new_tar)>=0.52,arr.ind = T)
which(cor(genotype_new_tar)<=0.53&
cor(genotype_new_tar)>=0.52,arr.ind = T)
range(cor(genotype_new[,1:100])[upper.tri(cor(genotype_new[,1:100]))])
sample[23,]
sample[19,]
head(sample)
idx1 <- which(sample$ID=="NA19331"
)
idx2 <- which(sample$ID=="NA19334")
idx1
idx2
cor(genotype_common[,idx1],
genotype_common[,idx2])
idx1 <- which(sample$ID=="NA20359"
)
idx2 <- which(sample$ID=="NA20362")
cor(genotype_common[,idx1],
genotype_common[,idx2])
setwd("/Users/haoyuzhang/GoogleDrive/multi_ethnic")
setwd("/Users/haoyuzhang/GoogleDrive/multi_ethnic")
sample <- as.data.frame(fread("./Hapgen2_test/1kg/1000GP_Phase3.sample",header=T))
library(data.table)
sample <- as.data.frame(fread("./Hapgen2_test/1kg/1000GP_Phase3.sample",header=T))
idx1 <- which(sample$ID=="NA20359"
)
idx2 <- which(sample$ID=="NA20362")
sample[idx1,]
sample[idx2,]
idx1 <- which(sample$ID=="NA19904"
)
idx2 <- which(sample$ID=="NA19913")
sample[idx1,]
sample[idx2,]
cor(genotype_common[,idx1],
genotype_common[,idx2])
ex.haps <- as.data.frame(fread("./Hapgen2_test/1kg/test.hap"),header=F)
dim(ex.haps)
n.sub <- ncol(ex.haps)/2
n.snp <- nrow(ex.haps)
genotype <- matrix(0,n.snp,n.sub)
for(k in 1:n.sub){
genotype[,k] <- ex.haps[,2*k-1]+ex.haps[,2*k]
}
MAF <- rowSums(genotype)/(2*n.sub)
idx <- which(MAF>=0.05&MAF<=0.95)
genotype_common <- genotype[idx,]
length(idx)
genotype_new <- genotype_common
for(k in 1:length(idx)){
genotype_new[k,] <- (genotype_common[k,]-2*MAF[idx[k]])/(sqrt(2*MAF[idx[k]]*(1-MAF[idx[k]])))
}
idx1 <- which(sample$ID=="NA19904"
)
idx2 <- which(sample$ID=="NA19913")
sample[idx1,]
sample[idx2,]
cor(genotype_common[,idx1],
genotype_common[,idx2])
idx1 <- which(sample$ID=="HG03343"
)
idx2 <- which(sample$ID=="HG03352")
sample[idx1,]
sample[idx2,]
cor(genotype_common[,idx1],
genotype_common[,idx2])
load("/data/zhangh24/multi_ethnic/result/LD_simulation/EUR/causal_genotype.rdata")
#get the best performance eur prs p-value threshold
jdx = which.max(r2.mat[,1])
n.snp.total<-0
